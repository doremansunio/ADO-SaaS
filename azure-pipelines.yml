# File: my-flexible-dotnet-api-repo/.azuredevops/azure-pipelines.yml
#
# This pipeline file is automatically generated and managed by the Platform Automation team.
# It extends a standardized template from the central platform repository.
#
# DO NOT EDIT THIS FILE DIRECTLY unless you understand the implications of template extension.
# Any changes made here may be overwritten by subsequent runs of the meta-pipeline.
# For application-specific configuration, please refer to the params.json in the 'config' folder
# or adjust the parameters in the 'extends' section below with caution.

trigger:
  # Triggers for the application's repository.
  batch: true
  branches:
    include:
    - main
    - features/*
    - bugfixes/*
  paths:
    exclude:
    - config/params.json # Changes to params.json alone should not trigger CI/CD.

pr:
  # Pull Request triggers for the application's repository.
  branches:
    include:
    - main
    - features/*
    - bugfixes/*

resources:
  # Defines the external repository containing the shared pipeline templates.
  repositories:
    - repository: platform_templates
      type: git
      name: YourOrg/PlatformAutomation # Dynamically populated by the meta-pipeline. Replace with your actual org/project.
      ref: main # Specifies the branch of the template repository to use.

extends:
  # This section extends the main CI/CD template from the 'platform_templates' repository.
  template: templates/dotnet-ci-cd.yml@platform_templates # Path to the template within the external repo.
  parameters:
    # Parameters passed to the extended CI/CD template.
    # These values are derived from the application's configuration JSON by the meta-pipeline.
    appName: 'Value-from-meta-pipeline-appName'
    solutionPath: 'Value-from-meta-pipeline-solutionPath'
    testProjectPath: 'Value-from-meta-pipeline-testProjectPath'
    techStack: 'Value-from-meta-pipeline-techStack'
    buildTool: 'Value-from-meta-pipeline-buildTool'
    azureSubscriptionServiceConnection: 'Value-from-meta-pipeline-azureSubscriptionServiceConnection'
    agentPoolName: 'Value-from-meta-pipeline-agentPoolName'
    enableCI: true                # Default: CI (Build & Test) execution is enabled.
    enableCD: false               # Default: CD (Deployment) steps are disabled.
                                  # Change to 'true' here to enable deployments after setup.

    # Environment-specific parameters for Dev deployment.
    devAppUrlForTests: 'Value-from-meta-pipeline-devAppUrlForTests'
    devDeploymentType: 'Value-from-meta-pipeline-devDeploymentType'
    devAppServiceName: 'Value-from-meta-pipeline-devAppServiceName'
    devTargetOS: 'Value-from-meta-pipeline-devTargetOS'
    devAppServicePlanName: 'Value-from-meta-pipeline-devAppServicePlanName'
    devAppServerName: 'Value-from-meta-pipeline-devAppServerName'
    devWinRmServiceConnection: 'Value-from-meta-pipeline-devWinRmServiceConnection'
    devSshServiceConnection: 'Value-from-meta-pipeline-devSshServiceConnection'
    devRemotePath: 'Value-from-meta-pipeline-devRemotePath'
    devK8sServiceConnection: 'Value-from-meta-pipeline-devK8sServiceConnection'
    devK8sNamespace: 'Value-from-meta-pipeline-devK8sNamespace'
    devImageName: 'Value-from-meta-pipeline-devImageName'
    devImageTag: 'Value-from-meta-pipeline-devImageTag'

    # Environment-specific parameters for QA deployment.
    qaAppUrlForTests: 'Value-from-meta-pipeline-qaAppUrlForTests'
    qaDeploymentType: 'Value-from-meta-pipeline-qaDeploymentType'
    qaAppServiceName: 'Value-from-meta-pipeline-qaAppServiceName'
    qaTargetOS: 'Value-from-meta-pipeline-qaTargetOS'
    qaAppServicePlanName: 'Value-from-meta-pipeline-qaAppServicePlanName'
    qaAppServerName: 'Value-from-meta-pipeline-qaAppServerName'
    qaWinRmServiceConnection: 'Value-from-meta-pipeline-qaWinRmServiceConnection'
    qaSshServiceConnection: 'Value-from-meta-pipeline-qaSshServiceConnection'
    qaRemotePath: 'Value-from-meta-pipeline-qaRemotePath'
    qaK8sServiceConnection: 'Value-from-meta-pipeline-qaK8sServiceConnection'
    qaK8sNamespace: 'Value-from-meta-pipeline-qaK8sNamespace'
    qaImageName: 'Value-from-meta-pipeline-qaImageName'
    qaImageTag: 'Value-from-meta-pipeline-qaImageTag'

    # Environment-specific parameters for Prod deployment.
    prodAppUrlForTests: 'Value-from-meta-pipeline-prodAppUrlForTests'
    prodDeploymentType: 'Value-from-meta-pipeline-prodDeploymentType'
    prodAppServiceName: 'Value-from-meta-pipeline-prodAppServiceName'
    prodTargetOS: 'Value-from-meta-pipeline-prodTargetOS'
    prodAppServicePlanName: 'Value-from-meta-pipeline-prodAppServicePlanName'
    prodAppServerName: 'Value-from-meta-pipeline-prodAppServerName'
    prodWinRmServiceConnection: 'Value-from-meta-pipeline-prodWinRmServiceConnection'
    prodSshServiceConnection: 'Value-from-meta-pipeline-prodSshServiceConnection'
    prodRemotePath: 'Value-from-meta-pipeline-prodRemotePath'
    prodK8sServiceConnection: 'Value-from-meta-pipeline-prodK8sServiceConnection'
    prodK8sNamespace: 'Value-from-meta-pipeline-prodK8sNamespace'
    prodImageName: 'Value-from-meta-pipeline-prodImageName'
    prodImageTag: 'Value-from-meta-pipeline-prodImageTag'