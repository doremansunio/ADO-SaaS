# File: my-flexible-dotnet-api-repo/.azuredevops/azure-pipelines.yml
# Generated by PlatformAutomation/meta-pipeline.yml - DO NOT EDIT MANUALLY
# To make changes, update configs/my-flexible-dotnet-api.json in the PlatformAutomation repo.

trigger:
  branches:
    include:
      - main
  paths:
    include:
      - '*' # Trigger on any change to the app repo

resources:
  repositories:
    - repository: platform_templates # Alias for the PlatformAutomation repo
      type: git
      name: $(System.TeamProject)/PlatformAutomation # Adjust if your PlatformAutomation repo is in another project
      ref: main

extends:
  template: templates/dotnet-ci-cd.yml@platform_templates
  parameters:
    appName: 'MyFlexibleDotnetApi'
    repoName: 'my-flexible-dotnet-api-repo'
    solutionPath: 'src/MyFlexibleDotnetApi.sln'
    testProjectPath: 'tests/MyFlexibleDotnetApi.Tests/MyFlexibleDotnetApi.Tests.csproj'
    techStack: 'dotnet'
    azureSubscriptionServiceConnection: 'YOUR_AZURE_SUBSCRIPTION_SC_NAME'
    agentPoolName: 'Azure Pipelines'
    containerRegistryServiceConnection: 'YOUR_ACR_SC_NAME'
    enableCI: true
    enableCD: true

    # Dev Environment Params
    devDeploymentType: 'azureWebApp'
    devAppServiceName: 'myflexibledotnetapi-dev'
    devResourceGroupName: 'rg-myflexibledotnetapi-dev'
    devAppUrlForTests: 'https://myflexibledotnetapi-dev.azurewebsites.net'
    devAppServerName: '' # Not applicable for azureWebApp
    devWinRmServiceConnection: '' # Not applicable
    devRemotePath: '' # Not applicable
    devK8sImageName: '' # Not applicable
    devK8sNamespace: '' # Not applicable
    devK8sDeploymentName: '' # Not applicable
    devK8sServiceConnection: '' # Not applicable
    devK8sContainerPort: 80 # Default, not applicable here

    # QA Environment Params
    qaDeploymentType: 'azureWebApp'
    qaAppServiceName: 'myflexibledotnetapi-qa'
    qaResourceGroupName: 'rg-myflexibledotnetapi-qa'
    qaAppUrlForTests: 'https://myflexibledotnetapi-qa.azurewebsites.net'
    qaAppServerName: ''
    qaWinRmServiceConnection: ''
    qaRemotePath: ''
    qaK8sImageName: ''
    qaK8sNamespace: ''
    qaK8sDeploymentName: ''
    qaK8sServiceConnection: ''
    qaK8sContainerPort: 80

    # Prod Environment Params
    prodDeploymentType: 'none' # As per example, prod is disabled
    prodAppServiceName: ''
    prodResourceGroupName: ''
    prodAppUrlForTests: ''
    prodAppServerName: ''
    prodWinRmServiceConnection: ''
    prodRemotePath: ''
    prodK8sImageName: ''
    prodK8sNamespace: ''
    prodK8sDeploymentName: ''
    prodK8sServiceConnection: ''
    prodK8sContainerPort: 80

    #   # Dev Environment Params (Azure Web App is ENABLED)
    # devDeploymentType: 'azureWebApp'
    # devAppServiceName: 'myflexibledotnetapi-dev-001'
    # devResourceGroupName: 'rg-myflexibledotnetapi-dev'
    # devAppUrlForTests: 'https://myflexibledotnetapi-dev-001.azurewebsites.net'
    # devAppServerName: '' 
    # devWinRmServiceConnection: '' 
    # devRemotePath: '' 
    # devK8sImageName: '' 
    # devK8sNamespace: '' 
    # devK8sDeploymentName: '' 
    # devK8sServiceConnection: '' 
    # devK8sContainerPort: 80 

    # # QA Environment Params (On-Premise FCI is ENABLED)
    # qaDeploymentType: 'onPremiseFCI'
    # qaAppServiceName: ''
    # qaResourceGroupName: ''
    # qaAppUrlForTests: 'https://myflexibledotnetapi-qa-node.internal.net'
    # qaAppServerName: 'qa-webserver.internal.net'
    # qaWinRmServiceConnection: 'QA_OnPrem_WinRM_SC'
    # qaRemotePath: 'C:\\inetpub\\wwwroot\\MyFlexibleDotnetApi-QA'
    # qaK8sImageName: ''
    # qaK8sNamespace: ''
    # qaK8sDeploymentName: ''
    # qaK8sServiceConnection: ''
    # qaK8sContainerPort: 80

    # # Prod Environment Params (OpenShift is ENABLED)
    # prodDeploymentType: 'openShift'
    # prodAppServiceName: ''
    # prodResourceGroupName: ''
    # prodAppUrlForTests: 'https://api-myflexibledotnetapi-prod.openshift.net'
    # prodAppServerName: ''
    # prodWinRmServiceConnection: ''
    # prodRemotePath: ''
    # prodK8sImageName: 'myacr.azurecr.io/myflexibledotnetapi:$(Build.BuildId)'
    # prodK8sNamespace: 'myflexibledotnetapi-prod'
    # prodK8sDeploymentName: 'myflexibledotnetapi'
    # prodK8sServiceConnection: 'Prod_OpenShift_SC'
    # prodK8sContainerPort: 80